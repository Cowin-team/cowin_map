{"version":3,"sources":["webpack://the_cowin_map/./assets/js/src/entry/map.js"],"names":["map","locations","allCowinMarkers","locationFromDataRow","dataRow","location","title","latitude","parseFloat","longitude","url","covidbed","oxybed","icu","venti","updatedAt","undefined","drawMarkers","options","cowinMarkers","bounds","google","maps","LatLngBounds","forEach","cowinMarker","shouldRenderMarker","shouldHaveCovidBeds","hasCovidBeds","shouldHaveOxygenBeds","hasOxygenBeds","shouldHaveICUs","hasICUs","shouldHaveVentilators","hasVentilators","mapMarker","setMap","isNaN","extend","position","fitBounds","createCowinMarker","infowindow","lat","lng","Marker","descriptionHtml","hasAttribute","attr","event","addListener","setContent","open","window","addEventListener","drawOptions","detail","checkedFilterNames","filterName","initialiseMap","Map","document","getElementById","zoom","center","LatLng","InfoWindow","content","cities","coimbatore","bedsSpreadheetId","tripur","cityName","sheetUrl","$","getJSON","data","values","push"],"mappings":"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","file":"map.js","sourcesContent":["var map;\nvar locations = [];\nvar allCowinMarkers = [];\n\nwindow.addEventListener(\"filtersChanged\", function(event){\n  let drawOptions = {\n    shouldHaveCovidBeds: false,\n    shouldHaveOxygenBeds: false,\n    shouldHaveICUs: false,\n    shouldHaveVentilators: false\n  }\n\n  event.detail.checkedFilterNames.forEach(function(filterName) {\n    if (filterName == \"show_covid_beds\")  {\n      drawOptions.shouldHaveCovidBeds = true;\n    } else if (filterName == \"show_oxygen_beds\")  {\n      drawOptions.shouldHaveOxygenBeds = true;\n    } else if (filterName == \"show_icus\")  {\n      drawOptions.shouldHaveICUs = true;\n    } else if (filterName == \"show_ventilators\")  {\n      drawOptions.shouldHaveVentilators = true;\n    }\n  });\n\n  drawMarkers(drawOptions, allCowinMarkers);\n});\n\nfunction locationFromDataRow(dataRow) {\n  let location = {\n    title: dataRow[0],\n    latitude: parseFloat(dataRow[2]),\n    longitude: parseFloat(dataRow[3]),\n    // institution: dataRow[3],\n    // department: dataRow[4],\n    // funder: dataRow[0],\n    url: dataRow[4],\n    covidbed: dataRow[5],\n    oxybed: dataRow[6],\n    icu: dataRow[7],\n    venti: dataRow[8],\n    updatedAt: dataRow[9]\n  }\n\n  if (location.covidbed === undefined) { location.covidbed = \"N/A\" };\n  if (location.oxybed === undefined) { location.oxybed = \"N/A\" };\n  if (location.icu === undefined) { location.icu = \"N/A\" };\n  if (location.venti === undefined) { location.venti = \"N/A\" };\n\n  return location;\n};\n\n\nfunction initialiseMap() {\n  // Center on (0, 0). Map center and zoom will reconfigure later (fitbounds method)\n  map = new google.maps.Map(document.getElementById('map'), {\n    zoom: 10,\n    center: new google.maps.LatLng(0, 0)\n  });\n  let infowindow = new google.maps.InfoWindow({ content: \"Content String\" });\n\n  let cities = {\n    coimbatore: {\n      bedsSpreadheetId:  \"1WW1Lu7S8zP85Qzv-Pn7gp_KUxPJZzvrXnGoWOkwcdbw\",\n    },\n    tripur: {\n      bedsSpreadheetId: \"1T5fUP5nhCctC2bpNWeO4Yg2UYrewbTxrGh58c2zJePU\"\n    }\n  };\n  let apiKey = \"AIzaSyClGVndCtMIDvZ7GdE1fO5OPQL5XdtMvVM\";\n  for (const cityName in cities) {\n    let city = cities[cityName];\n    let sheetUrl = \"https://sheets.googleapis.com/v4/spreadsheets/\"+\n      `${city.bedsSpreadheetId}/values/Sheet1!A2:Q?key=${apiKey}`\n    $.getJSON(sheetUrl, function(data) {\n      // data.values contains the array of rows from the spreadsheet.\n      // Each row is also an array of cell values.\n      data.values.forEach(function(dataRow) {\n        let location = locationFromDataRow(dataRow);\n        locations.push(location);\n      });\n      locations.forEach(function(location){\n        allCowinMarkers.push(createCowinMarker(map, location, infowindow));\n      });\n      drawMarkers(null, allCowinMarkers);\n    });\n  }\n}\nwindow.initialiseMap = initialiseMap;\n\nfunction drawMarkers(options, cowinMarkers) {\n  let bounds = new google.maps.LatLngBounds();\n  cowinMarkers.forEach(function(cowinMarker) {\n    let shouldRenderMarker = true;\n\n    if (options != null) {\n      if ((options.shouldHaveCovidBeds && !cowinMarker.hasCovidBeds) ||\n        (options.shouldHaveOxygenBeds && !cowinMarker.hasOxygenBeds) ||\n        (options.shouldHaveICUs && !cowinMarker.hasICUs) ||\n        (options.shouldHaveVentilators && !cowinMarker.hasVentilators)) {\n\n          shouldRenderMarker = false;\n        }\n    }\n\n    if (shouldRenderMarker) {\n      cowinMarker.mapMarker.setMap(map);\n      if (!isNaN(cowinMarker.location.latitude) && !isNaN(cowinMarker.location.longitude)) {\n        bounds.extend(cowinMarker.mapMarker.position);\n      }\n    } else {\n      cowinMarker.mapMarker.setMap(null);\n    }\n  });\n  map.fitBounds(bounds);\n}\n\nfunction createCowinMarker(map, location, infowindow) {\n  // Modify the code below to suit the structure of your spreadsheet (stored in variable 'location')\n  let position = {\n    lat: parseFloat(location.latitude),\n    lng: parseFloat(location.longitude)\n  };\n  let mapMarker = new google.maps.Marker({\n    position: position,\n    map: null,\n    title: location.title\n  });\n\n  let descriptionHtml = `\n    <div class=\"content\">\n      <h5 class=\"title is-5 mb-0\">\n       ${(location.url === undefined) ? location.title : ('<a href=\"' + location.url +'\">' + location.title + '</a>')}\n      </h5>\n      <p class=\"is-size-7 mt-1\">Updated at: ${location.updatedAt}</p>\n      <table class=\"table has-text-left is-striped is-narrow is-hoverable\">\n        <tr><th>COVID Beds: </th><td>${location.covidbed}</td></tr>\n        <tr><th>Oxygen Beds: </th><td>${location.oxybed}</td></tr>\n        <tr><th>ICUs: </th><td>${location.icu}</td></tr>\n        <tr><th>Ventilators: </th><td>${location.venti}</td></tr>\n      </table>\n    </div>\n  `\n  google.maps.event.addListener(mapMarker, 'click', function() {\n    infowindow.setContent(descriptionHtml);\n    infowindow.open(map, mapMarker);\n  });\n\n  function hasAttribute(attr) {\n    if (location[attr] === undefined || location[attr] === \"\") {\n      return false;\n    }\n    if (isNaN(location[attr])) {\n      return false;\n    }\n    if (parseFloat(location[attr]) < 1) {\n      return false;\n    }\n\n    return true;\n  }\n\n  return {\n    location: location,\n    mapMarker: mapMarker,\n    hasCovidBeds: hasAttribute(\"covidbed\"),\n    hasOxygenBeds: hasAttribute(\"oxybed\"),\n    hasICUs: hasAttribute(\"icu\"),\n    hasVentilators: hasAttribute(\"venti\")\n  };\n}\n"],"sourceRoot":""}
(()=>{"use strict";var t=class{constructor(t,e,s){this.name=t,this.spreadsheetIds=e,this.covidBedLocations=[],this.covidBedMarkers=[],this.afterFetchCallback=s,this.fetchCovidBedData()}fetchCovidBedData(){let t=`https://sheets.googleapis.com/v4/spreadsheets/${this.spreadsheetIds.covidBeds}/values/Sheet1!A2:Q?key=AIzaSyClGVndCtMIDvZ7GdE1fO5OPQL5XdtMvVM`;fetch(t).then((t=>t.json())).then((t=>{t.values.forEach((t=>{let e=new class{constructor(t){this.title=t[0],this.latitude=parseFloat(t[2]),this.longitude=parseFloat(t[3]),this.url=t[4],this.covidbed=void 0===t[5]?"N/A":t[5],this.oxybed=void 0===t[6]?"N/A":t[6],this.icu=void 0===t[7]?"N/A":t[7],this.venti=void 0===t[8]?"N/A":t[8],this.updatedAt=t[9],this.position={lat:this.latitude,lng:this.longitude},this.hasCovidBeds=this.hasAttribute("covidbed"),this.hasOxygenBeds=this.hasAttribute("oxybed"),this.hasICUs=this.hasAttribute("icu"),this.hasVentilators=this.hasAttribute("venti")}hasAttribute(t){return!(void 0===this[t]||""===this[t]||isNaN(this[t])||parseFloat(this[t])<1)}}(t);this.covidBedLocations.push(e),this.covidBedMarkers.push(new class{constructor(t){this.location=t,this.marker=new google.maps.Marker({position:t.position,map:null,title:t.title}),this.position=this.marker.position,this.descriptionHtml=`\n      <div class="content">\n        <h5 class="title is-5 mb-0">\n         ${void 0===t.url?t.title:'<a href="'+t.url+'">'+t.title+"</a>"}\n        </h5>\n        <p class="is-size-7 mt-1">Updated at: ${t.updatedAt}</p>\n        <table class="table has-text-left is-striped is-narrow is-hoverable">\n          <tr><th>COVID Beds: </th><td>${t.covidbed}</td></tr>\n          <tr><th>Oxygen Beds: </th><td>${t.oxybed}</td></tr>\n          <tr><th>ICUs: </th><td>${t.icu}</td></tr>\n          <tr><th>Ventilators: </th><td>${t.venti}</td></tr>\n        </table>\n      </div>\n    `}setMap(t){this.marker.setMap(t)}}(e))})),this.afterFetchCallback(this.covidBedMarkers)}))}};window.initialiseMap=function(){let e=new class{constructor(){this.map=null,this.initialiseMap(),this.markerInfoWindow=new google.maps.InfoWindow({content:""}),this.cowinMapMarkers=[],this.bounds=new google.maps.LatLngBounds,this.mapFilters=new class{constructor(t){this.state={shouldHaveCovidBeds:!1,shouldHaveOxygenBeds:!1,shouldHaveICUs:!1,shouldHaveVentilators:!1},this.setEventListeners(),this.onChangeCallback=t}getCurrentSelection(){return this.state}setEventListeners(){let t=this;document.querySelectorAll(".filters_form input").forEach((function(e){e.addEventListener("change",(e=>{t.filterChanged(e.target)}))}))}filterChanged(t){let e=t.dataset.filterName;"show_covid_beds"==e?this.state.shouldHaveCovidBeds=t.checked:"show_oxygen_beds"==e?this.state.shouldHaveOxygenBeds=t.checked:"show_icus"==e?this.state.shouldHaveICUs=t.checked:"show_ventilators"==e&&(this.state.shouldHaveVentilators=t.checked),this.onChangeCallback(this.state)}}((t=>{this.plotAllCowinMapMarkers()}))}initialiseMap(){this.map=new google.maps.Map(document.getElementById("map"),{zoom:10,center:new google.maps.LatLng(0,0)})}setupAndPlotCowinMapMarker(t){google.maps.event.addListener(t.marker,"click",(()=>{this.markerInfoWindow.setContent(t.descriptionHtml),this.markerInfoWindow.open(this.map,t.marker)})),this.cowinMapMarkers.push(t)}plotCowinMapMarker(t){let e=!0,s=this.mapFilters.getCurrentSelection();(s.shouldHaveCovidBeds&&!t.location.hasCovidBeds||s.shouldHaveOxygenBeds&&!t.location.hasOxygenBeds||s.shouldHaveICUs&&!t.location.hasICUs||s.shouldHaveVentilators&&!t.location.hasVentilators)&&(e=!1),e?(t.setMap(this.map),isNaN(t.location.latitude)||isNaN(t.location.longitude)||this.bounds.extend(t.position)):t.setMap(null)}plotAllCowinMapMarkers(){this.cowinMapMarkers.forEach((t=>{this.plotCowinMapMarker(t)})),this.map.fitBounds(this.bounds)}},s=t=>{t.forEach((t=>{e.setupAndPlotCowinMapMarker(t)})),e.plotAllCowinMapMarkers()};new t("coimbatore",{covidBeds:"1WW1Lu7S8zP85Qzv-Pn7gp_KUxPJZzvrXnGoWOkwcdbw"},s),new t("tirupur",{covidBeds:"1T5fUP5nhCctC2bpNWeO4Yg2UYrewbTxrGh58c2zJePU"},s)}})();
//# sourceMappingURL=index.js.map